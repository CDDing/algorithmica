---
title: Pipeline Hazards
weight: 1
published: true
---

[파이프라이닝](../)은 여러 명령어를 동시에 실행함으로써 지연 시간을 숨겨줄 수 있지만, 동시에 고유의 잠재적인 문제를 야기하기도 합니다. 이러한 문제들은 일반적으로 파이프라인 위험(pipeline hazard)라 불리며, 이는 다음 명령어가 다음 클럭 사이클에 실행될 수 없는 상황을 말합니다.

이러한 문제가 발생하는 원인은 다양합니다.

* **구조적 위험(structural hazard)**은 둘 이상의 명령어가 CPU의 동일한 자원(예: 실행 유닛)을 동시에 필요로 할 때 발생합니다.
* **데이터 위험(data hazard)**은 앞선 단계에서 어떤 피연산자의 계산이 완료되기를 기다려야할 때 발생합니다.
* **제어 위험(control hazard)**은 CPU가 다음에 어떤 명령어를 실행해야 할 지 알수 없을 때 발생합니다.

이러한 해저드를 해결하는 유일한 방법은, **파이프라인 정지(pipeline stall)**을 거는 것입니다. 이는 정체의 원인이 사라질 때까지 모든 이전 단계의 진행을 멈추는 것을 의미합니다. 이로 인해 파이프라인에 버블이 생기는데, 이는 마치 유체 파이프 안의 공기 방울처럼 실행 유닛들으 유휴 상태로 아무런 유용한 작업도 하지 않는 시간 지연 상태를 의미합니다.

![Pipeline stall on the execution stage](../img/bubble.png)

위험의 종류에 따라 성능에 미치는 영향도 다릅니다.

- 구조적 위험은 실행 유닛이 준비될 때 까지(대개 1사이클 이상) 기다려야합니다. 이는 피할 수 없는 성능 병목이며, 이를 중심으로 아키텍처를 설계해야 합니다.
- 데이터 위험은 필요한 데이터가 계산되기를 기다려야 하며, 이는 임계 경로(critical path)에 따른 지연입니다. 해결 방법은 계산 순서를 재구성하여 이 경로를 짧게 만드는 것입니다.
- 제어 위험은 일반적으로 파이프라인 전체를 비우고 다시 시작해야 하므로 15~20 사이클이 낭비됩니다. 해결 방법은 분기를 아예 제거하거나, CPU가 다음 명령어를 예측할 수 있도록 만들어 분기 예측을 가능하게 하는 것입니다.

이 세 가지 위험은 성능에 미치는 영향이 다르므로, 우리는 가장 심각한 것부터 시작하여 역순으로 살펴볼 것입니다.
